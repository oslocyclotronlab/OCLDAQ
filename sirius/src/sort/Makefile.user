# -*- Makefile -*-

BASEDIR = $(SORTDIR)/../..
include $(BASEDIR)/makefile-head

USER_ROUTINE_O = $(USER_ROUTINE_SRC:%.cpp=%.o)
USER_OFFLINE_O = $(USER_OFFLINE_SRC:%.cpp=%.o)

LIBSIRIUS      = $(SORTDIR)/../lib/libsirius.a
LIBSORT        = $(SORTDIR)/libsort.a
LIBOFFLINE     = $(SORTDIR)/liboffline$(BASIC).a

S_SRCS         = $(USER_ROUTINE_SRC)
S_OBJS         = $(S_SRCS:%.cpp=%.o)

O_SRCS         = $(USER_OFFLINE_SRC)
O_OBJS         = $(O_SRCS:%.cpp=%.o)

SORT           = acq_sort
OFFLINE        = offline_sort

CXXFLAGS       += -I$(SORTDIR) `root-config --cflags`
LIBS           += -lm `root-config --libs`
LDLIB          = $(CXX) -shared 

OBJECTS        = $(S_OBJS) $(O_OBJS)
TARGETS        = $(SORT) $(OFFLINE)

all: $(TARGETS)

install: install-targets

$(SORT): $(S_OBJS) $(LIBSORT) $(LIBSIRIUS)
	@$(ECHO) $(CXXLMSG) $@
	$H $(CXX) $(LIBS) $^ -o $@

$(OFFLINE): $(O_OBJS) $(LIBOFFLINE) $(LIBSIRIUS)
	@$(ECHO) $(CXXLMSG) $@
	$H $(CXX) $(LIBS) $^ -o $@

$(LIBSIRIUS):
	@$(MAKE) -C $(shell dirname $@) $(shell basename $@)

$(LIBSORT):
	@$(MAKE) -C $(shell dirname $@) $(shell basename $@)

$(LIBOFFLINE):
	@$(MAKE) -C $(shell dirname $@) $(shell basename $@)

include $(MAKEFILE_TAIL)
